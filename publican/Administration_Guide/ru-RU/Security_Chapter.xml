<?xml version='1.0' encoding='UTF-8'?>
<!-- This document was created with Syntext Serna Free. --><!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Administration_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Administration_Guide-Security_Chapter">
  <title>Безопасность в Platypus</title>
  <para>Платформа Platypus имеет развитые механизмы обеспечения безопасности и обеспечивает ограничение доступа к ресурсам в системе на основе ролей назначенных пользователям и их группам. Могут вводится ограничения доступа к следующим ресурсам:</para>
  <itemizedlist>
    <listitem>
      <para>Программный модуль любого уровня -  на сервере или клиенте</para>
    </listitem>
    <listitem>
      <para>Функция в  программном модуле</para>
    </listitem>
    <listitem>
      <para>Форма; </para>
    </listitem>
    <listitem>
      <para>Зпрос к базе данных</para>
    </listitem>
    <listitem>
      <para>Отчет </para>
    </listitem>
  </itemizedlist>
  <para>Разграничения на доступ к ресурсам осуществляются на базе ролей. Роли вводятся на уровне приложения Platypus и являются его частью.</para>
  <para>Для элемента приложения типа <emphasis>Запрос к базе данных</emphasis> могут определяться правила доступа для роли: полный доступ, только чтение (выполнение запросов <literal>SELECT</literal>), запись (выполнение команд <literal>INSERT</literal>, <literal>DELETE</literal> и <literal>UPDATE</literal>).</para>
  <para>С точки зрения аутентификации,  Platypus может использовать &quot;область безопасности&quot;. Область безопасности может быть встроенной или внешней и содержать информацию  о  пользователях  и об их принадлежности к группам. Platypus поддерживает следующие варианты области безопасности: </para>
  <itemizedlist>
    <listitem>
      <para>встроенная &quot;база данных&quot; пользователей, размещаемая в 2х таблицах БД - может использоваться при работе как по 2-х так и 3-х звенной схеме; </para>
    </listitem>
    <listitem>
      <para>внешние хранилища аутентификационных данных, например, сервер LDAP (Active Directory, OpenLDAP и т.д.), данный режим может использоваться только при работе по  3-х звенной схеме в сервлет-контейнере или J2EE сервере.</para>
    </listitem>
  </itemizedlist>
  <para>В области безопасности для пользователя определяется набор &quot;групп&quot; или &quot;глобальных ролей&quot; которым могут быть поставлены в соответствие роли на уровне приложения.</para>
  <section>
    <title>Настройка безопасности при работе в J2EE контейнере</title>
    <para>При работе приложения в J2EE контейнере Platypus использует механизм аутентификации  и роли предоставляемые J2EE контейнером. Для активизации ролевого доступа в данном случае необходимо чтобы пользователь прошел ограничение безопасности и  получил какую-либо  роль. Для этого настройте ограничение безопасности на URL  на страницу на которой размещаются формы Platypus для которых необходимо обеспечить контоль доступа на базе ролей. На приведенном ниже примере включено ограничение безопасности для страницы <filename>applicationStart.html</filename>, для доступа на которую пользватель должен обладать любой ролью:</para>
    <programlisting>...
&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
      &lt;url-pattern&gt;/application-start.html&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;*&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
    &lt;form-login-config&gt;
      &lt;form-login-page&gt;/login.html&lt;/form-login-page&gt;
      &lt;form-error-page&gt;/login-failed.html&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;
&lt;security-role&gt;
    &lt;role-name&gt;*&lt;/role-name&gt;
&lt;/security-role&gt;
...</programlisting>
    <para>Укажите тип аутентификации,  например <literal>FORM</literal> для аутентифифкации при помощи HTML форм или <literal>BASIC</literal> для базовой аутентификации в соответсвии с RFC 2617. </para>
    <para>Platypus Client поддерживает <literal>BASIC</literal> аутентификацию, поэтому для его корректной работы должен быть настроен именно этот тип аутентификаци. </para>
    <para>Настройте хранилище информации о пользователях и J2EE контейнер для использвания этого хранилища, более подробная информация об этих настойках представлена ниже.</para>
    <para>При работе приложения  в J2EE контейнере в добавлении к ограничениям безопасности платфомы Platypus необходимо использвать  встроенные средства web-сервера: </para>
    <itemizedlist>
      <listitem>
        <para>ограничте доступ к файлам приложения по протоколу HTTP; </para>
      </listitem>
      <listitem>
        <para>ограничте доступ к файлам приложения для загрузчика ресурсов Platypus, работающего по  URL вида:</para>
        <para><uri>application/resource/<replaceable>resourcePath</replaceable></uri></para>
        <para>где  <replaceable>resourcePath</replaceable> - путь к ресурсу в приложении Platypus.</para>
      </listitem>
    </itemizedlist>
    <para>Настройте разграничения доступа в файле дескриптора <filename>WEB-INF/web.xml</filename>.</para>
    <para>В приведенном ниже примере показан фрагмент файла <filename>WEB-INF/web.xml</filename> в котором ограничивается доступ к файлам приложения Platypus, размещенного в каталоге <filename>app</filename>, за исключением подкаталога <filename>public</filename>:</para>
    <programlisting>...
&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
      &lt;!-- whitelist --&gt;
      &lt;web-resource-name /&gt;
      &lt;url-pattern&gt;/app/public/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/application/resource/public/*
      &lt;/url-pattern&gt;
   &lt;/web-resource-collection&gt;
   &lt;!-- No auth constraint here for whitelist --&gt;
&lt;/security-constraint&gt;

&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
      &lt;!-- everything other is restricted --&gt;
      &lt;web-resource-name /&gt;
      &lt;url-pattern&gt;/app/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/application/resource/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint /&gt;
&lt;/security-constraint&gt;
...</programlisting>
  </section>
  <section id="sect-Administration_Guide-Security_Chapter-Test_Section_2">
    <title>Настройка прав доступа пользователей при использовании встроенного хранилища информации о пользователях</title>
    <para>Использование встроенного хранилища  предоставляет простые инструменты для хранения информации о пользователях и их группах.</para>
    <para>Данный режим является единственным возможным режимом при работе в 2-х звенной схеме и  работе по 3-х звенной схеме в варианте работы сервера приложений Platypus вне J2EE сервера, а также может быть сконфигурирован при работе Platypus в составе J2ЕЕ сервера. Для использования этого режима в сервлет контейнере или в J2EE сервере  должна быть настроена соответствующая область безопасности - Security Realm.</para>
    <note>
      <para>Справочную информацию по настройке области безопасности для сервера Glassfish смотрите в приложении B: &quot;Настройка области безопасности LDAP&quot;.</para>
      <para>Справочную информацию по настройке области безопасности  для <application>Apache Tomcat</application>   смотрите в документации на сервлет-контейнер <application>Tomcat</application>.</para>
    </note>
    <para>В данном режиме  информация о пользователях хранится в базе данных приложения в таблице <literal>MTD_USERS</literal>. Каждая запись в этой таблице соответствует одному пользователю. Сведения о группах, к которым принадлежит пользователь хранятся в таблице <literal>MTD_GROUPS</literal>. Каждому пользователю может быть сопоставлено 0 и более групп.</para>
    <para>Таблица MTD_USERS содержит следующие обязательные поля:</para>
    <informaltable>
      <textobject>
        <para>Параметры запуска сервера</para>
      </textobject>
      <tgroup cols="2">
        <thead>
          <row>
            <entry align="center">Поле</entry>
            <entry align="center">Описание</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              <parameter>USR_NAME</parameter>
            </entry>
            <entry>Имя пользователя </entry>
          </row>
          <row>
            <entry>
              <parameter>USR_PASSWD</parameter>
            </entry>
            <entry>Хэш-сумма пароля пользователя, с использованием алгоритма MD5</entry>
          </row>
          <row>
            <entry>
              <parameter>USR_FORM</parameter>
            </entry>
            <entry>Идентификатор формы по умолчанию, например <literal>comAppFormsWelcome</literal></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>Кроме того, таблица <literal>MTD_USERS</literal> может содержать необязательные поля, содержащие дополнительную информацию о пользователе.</para>
    <para>Таблица <literal>MTD_GROUPS</literal> содержит следующие обязательные поля:</para>
    <informaltable>
      <textobject>
        <para>Параметры запуска сервера</para>
      </textobject>
      <tgroup cols="2">
        <thead>
          <row>
            <entry align="center">Поле</entry>
            <entry align="center">Описание</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              <parameter>USR_NAME</parameter>
            </entry>
            <entry>Имя пользователя </entry>
          </row>
          <row>
            <entry>
              <parameter>GROUP_NAME</parameter>
            </entry>
            <entry>Имя группы</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>Для разработки и тестирования приложений используйте технический логин <literal>admin</literal> c паролем <literal>masterkey</literal>. Пользователь <literal>admin</literal>   включен в группу <literal>admin</literal>. </para>
    <important>
      <para>Измените технический пароль перед началом промышленной эксплуатации приложения!</para>
    </important>
  </section>
  <section>
    <title>Использование внешнего хранилища информации о пользователях</title>
    <para>Данный режим дает возможность использования внешних сервисов для аутентификации пользователя, например <application>OpenLDAP</application> или <application>Microsoft Active Directory</application>.</para>
    <para>С этим режимом аутентификации могут работать Platypus Web API клиенты, HTML5 браузерный клиент и Java SE Platypus клиент при соединении с сервлет контейнером или J2EE сервером по протоколам HTTP/HTTPS. Для использования этого режима в сервлет контейнере или в J2EE сервере  должна быть настроена соответствующая область безопасности - Security Realm. </para>
    <note>
      <para>Справочную информацию по настройке области безопасности для сервера Glassfish смотрите в приложении B: &quot;Настройка области безопасности LDAP&quot;.</para>
      <para>Справочную информацию по настройке области безопасности  для <application>Apache Tomcat</application>   смотрите в документации на сервлет-контейнер <application>Tomcat</application>.</para>
    </note>
  </section>
</chapter>
