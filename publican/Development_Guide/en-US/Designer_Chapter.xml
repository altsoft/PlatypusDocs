<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Development_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="designer-chapter">
  <title>Application project</title>
  <para>In the course of development and further during the application life cycle, the application is represented by the application project.</para>
  <section id="new-project">
    <title>New project creation</title>
    <para>To create a  project, perform the following actions:
   <itemizedlist>
        <listitem>
          <para>Launch the application designer (if not launched yet). To do that, use the <guiicon>Platypus Application Designer</guiicon> shortcut on the desktop or the corresponding item in the installed applications menu.</para>
        </listitem>
        <listitem>
          <para>Select <menuchoice>
              <guimenu>File New</guimenu>
              <guimenuitem> Project</guimenuitem>
            </menuchoice> or click the  <guibutton>New Project</guibutton> button on the toolbar. </para>
        </listitem>
        <listitem>
          <para>Select the project type as the <classname>Platypus Application Project</classname>  and click  <guibutton>Next.</guibutton> </para>
        </listitem>
        <listitem>
          <para>Specify the project name and location:</para>
          <itemizedlist>
            <listitem>
              <para>Specify the project directory name in the <guilabel>Project Folder Name</guilabel> field.</para>
            </listitem>
            <listitem>
              <para>Select the parent directory, in which the Platypus application project will be created, in the  <guilabel>Project Location</guilabel> field.</para>
            </listitem>
            <listitem>
              <para>Specify the project title in the  <guilabel>Project Title</guilabel> field.</para>
            </listitem>
            <listitem>
              <para>Click <guibutton>Next</guibutton> to proceed to the next step.</para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>Click <guibutton>Finish</guibutton>  to finish the Platypus project creation.</para>
        </listitem>
      </itemizedlist>
New project will be added to the <guilabel>Projects</guilabel> panel. </para>
  </section>
  <section id="open-project">
    <title>Opening an existing project</title>
    <para>To open an existing  project, perform the following actions:
   <itemizedlist>
        <listitem>
          <para>Select  <menuchoice>
              <guimenu>File Open</guimenu>
              <guimenuitem> Project</guimenuitem>
            </menuchoice> or click the  <guibutton>Open Project</guibutton> button on the toolbar. </para>
        </listitem>
        <listitem>
          <para>Select the project parent directory using the selection dialog, select the project folder, and click the <guibutton>Open Project</guibutton> button.</para>
        </listitem>
      </itemizedlist>
Opened project will be added to the <guilabel>Projects</guilabel> panel. </para>
  </section>
  <section id="project-properties">
    <title>Project properties</title>
    <para>To change the project properties, select the <guimenuitem>Properties</guimenuitem> item in the project root node context menu.</para>
    <para>Set the application launching parameters:</para>
    <itemizedlist>
      <listitem>
        <para>Select the  <guilabel>Run</guilabel> category.</para>
      </listitem>
      <listitem>
        <para>Set the default application starting element; if necessary, use the application element selection dialog.</para>
      </listitem>
      <listitem>
        <para>Set the type of the client application to be launched: <guilabel>Platypus Client</guilabel> or <guilabel>HTML5 browser</guilabel>.</para>
      </listitem>
      <listitem>
        <para>Set the type of the server to be launched: <guilabel>No</guilabel>, <guilabel>Platypus Application Server</guilabel>, <guilabel>J2EE Server</guilabel>.</para>
      </listitem>
      <listitem>
        <para>Check the  <guilabel>Database application</guilabel> option to use an application, which is deployed in the database, when launching.</para>
      </listitem>
      <listitem>
        <para>Check the  <guilabel>Don&apos;t start application server</guilabel> option to launch the client only.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>Client</guilabel> tab, in the <guilabel>Url</guilabel> field specify the URL of the application server which will be used by the Platypus Client application when launching, if the  <guilabel>Don&apos;t start application server</guilabel> option is enabled.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>Client</guilabel> tab, in the <guilabel>Login</guilabel> and <guilabel>Password</guilabel> fields specify  login and password for the Platypus Client application.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>Client</guilabel> tab, in the <guilabel>Options</guilabel> field specify additional parameters of the Platypus Client application launching, for example, LaF (Look and Feel).</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>Platypus Application Server</guilabel> tab, in the <guilabel>Port</guilabel> field specify a  port for the development application server.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>Platypus Application Server</guilabel> tab, in the <guilabel>Options</guilabel> field set  additional parameters of the Platypus application server launching.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>J2EE Server</guilabel> tab, in the <guilabel>Server</guilabel> field select the server instance to be used for the application launching from the list of the installed J2EE servers.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>J2EE Server</guilabel> tab, in the <guilabel>Context</guilabel> field specify the name of the web-application in the J2EE server.</para>
      </listitem>
      <listitem>
        <para>On the <guilabel>J2EE Server</guilabel> tab, check the <guilabel>Enable security</guilabel> option to enable the security; in this case FORMS authentication  will be used for the web application.</para>
      </listitem>
    </itemizedlist>
    <para>Set the debugging parameters:</para>
    <itemizedlist>
      <listitem>
        <para>Set the Platypus Client debugging port.</para>
      </listitem>
      <listitem>
        <para>Set the application server debugging port.</para>
      </listitem>
    </itemizedlist>
    <para>Specify the applicaton&apos;s default datasource:</para>
    <itemizedlist>
      <listitem>
        <para>Select  the  database connecton from the list.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section id="project-structure">
    <title>Project structure</title>
    <para>A Platypus Platform project has the following structure:
   <itemizedlist>
        <listitem>
          <para>The project configuration files.</para>
        </listitem>
        <listitem>
          <para>The <guilabel>Application Elements</guilabel> node is the root directory, which contains the application elements tree.</para>
        </listitem>
      </itemizedlist></para>
    <para>You can perform the  following operations on the application elements and directories:</para>
    <itemizedlist>
      <listitem>
        <para>Create a new element using the  <command>New</command> command.</para>
      </listitem>
      <listitem>
        <para>Rename an application elementâ€”click  the selected application element  or  directory name, and press the  <keycap>F2</keycap> key.</para>
      </listitem>
      <listitem>
        <para>Copy and Paste an application element from the buffer to the specified project location using the  <command>Paste</command> command.</para>
      </listitem>
      <listitem>
        <para>Copy and Move the directory or the application elements to the specified project location. To copy, hold the <keycap>Ctrl</keycap> key while dragging a node. </para>
      </listitem>
      <listitem>
        <para>Delete an application element using the <command>Delete</command> command.</para>
      </listitem>
      <listitem>
        <para>Search for an element in the project using the  <command>Find</command> command.</para>
      </listitem>
    </itemizedlist>
    <para>These operations also avaliable by the element context menu, <menuchoice>
        <guimenu>Edit</guimenu>
      </menuchoice> menu in the main menu, or the keyboard hotkeys. Some application elements nodes supports some specific operations, e.g. running or debugging. Specific operations are described in detail in the sections dedicated to the certain types of  application elements.</para>
    <para>To create a subdirectory in the applicaton tree:</para>
    <itemizedlist>
      <listitem>
        <para>Select the <menuchoice>
            <guimenuitem>New</guimenuitem>
          </menuchoice> item in the parent directory context menu or select the parent directory and click  <menuchoice>
            <guimenuitem>New File</guimenuitem>
          </menuchoice> in the main menu, or click the <guibutton>New File</guibutton> button on the toolbar, or use the hotkey.</para>
      </listitem>
      <listitem>
        <para>Select the <guimenuitem>Folder</guimenuitem> type in the context menu or select  <menuchoice>
            <guimenu>Choose file type</guimenu>
            <guisubmenu> Platypus application elements </guisubmenu>
            <guimenuitem> Folder</guimenuitem>
          </menuchoice> on the wizard first step and click <guibutton>Next</guibutton>.</para>
      </listitem>
      <listitem>
        <para>Specify the name of the directory in the <guilabel>Name</guilabel> field and click <guibutton>Finish</guibutton> to create a  directory, or click <guibutton>Cancel</guibutton> to cancel.</para>
      </listitem>
    </itemizedlist>
    <para>To navigate to the application element, if its identifier is known:</para>
    <itemizedlist>
      <listitem>
        <para>Select <menuchoice>
            <guimenu>File</guimenu>
            <guimenuitem>Go to application element</guimenuitem>
          </menuchoice>, or use the <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>G</keycap>
          </keycombo> shortcut.</para>
      </listitem>
      <listitem>
        <para>In the dialog, specify the identifier of the application element in the  <guilabel>Provide application element id</guilabel> field of the dialog.</para>
      </listitem>
      <listitem>
        <para>Click <guibutton>OK</guibutton> to navigate to the application element, or click  <guibutton>Cancel</guibutton> to cancel.</para>
      </listitem>
    </itemizedlist>
    <para>To open an application element, select <guimenuitem>Open</guimenuitem> in the application element context menu, or double-click this element. The application element editor opens as a window in the  <application>Platypus Application Designer</application> editors area. </para>
    <para>To find out the identifier of an application element:</para>
    <itemizedlist>
      <listitem>
        <para>Select an application element in the projects application elements tree.</para>
      </listitem>
      <listitem>
        <para>Select <menuchoice>
            <guimenu>File</guimenu>
            <guimenuitem>Application element info</guimenuitem>
          </menuchoice> menu item, or use the <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>I</keycap>
          </keycombo> shortcut.</para>
      </listitem>
    </itemizedlist>
  </section>
  <section id="project-run-debug">
    <title>Running and debugging</title>
    <para>To run an application:</para>
    <itemizedlist>
      <listitem>
        <para>Click the <guibutton>Run project</guibutton> button on the main toolbar  to start a project&apos;s default application element or select  <guimenuitem>Run</guimenuitem>  context menu in an application element&apos;s such as a form, module or an JavaScript file.</para>
      </listitem>
      <listitem>
        <para>Select  <guimenuitem>Run</guimenuitem>  context menu in an application element&apos;s such as a form, module or an JavaScript file.</para>
      </listitem>
    </itemizedlist>
    <para>To debug an application:</para>
    <itemizedlist>
      <listitem>
        <para>Set  breakpoints in the JavaScript program.</para>
      </listitem>
      <listitem>
        <para>Click the <guibutton>Debug project</guibutton> button on the main toolbar or select the <guimenuitem>Debug</guimenuitem> item in an application element&apos;s context menu. The application will start and the debugger will be attached.</para>
      </listitem>
      <listitem>
        <para>After the debugger halts at the breakpoint, see the values of  variables and the call stack. To continue the program running, click the <guibutton>Continue</guibutton> button on the main toolbar. Use the Step over button or the  <keycap>F8</keycap> key, Step into or the  <keycap>F7</keycap> key, Step out or the <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>F7</keycap>
          </keycombo> shortcut for step-by-step execution of the program.</para>
      </listitem>
    </itemizedlist>
    <para>If the default application run element is not explicitly specified in the project&apos;s settings the selection dialog will be displayed.</para>
    <para>To debug an application running in an J2EE server or servlet container, e.g. Apache Tomcat provide the JMX configuration parameters as the server&apos;s start Java virtual machine options: <literal>-Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=<replaceable>port</replaceable></literal>  where <replaceable>port</replaceable> is the port to attach the debugger. For Apache Tomcat enter these options in the <guilabel>VM Options</guilabel> field on the <guilabel>Platform</guilabel> tab of the server&apos;s configuration parameters on the <guilabel>Services</guilabel> panel. After the server starts use <guilabel>Attach Debugger</guilabel> menu item on the <guilabel>Debug Project</guilabel> button on the main toolbar and specify the debugging port.</para>
    <para>When launching the application in a J2EE server, <application>Platypus Application Designer</application> uses the  <filename>web</filename> sub-directory, which is created automatically in the project directory. When initializing this sub-directory, its initial structure is created and  libraries are copied. After initializing  the directory,  files responsible for the configuration (<filename>WEB-INF/web.xml</filename>, server specific configuration file, and JavaScript file responsible for the application  launching on the HTML page) are modified, but the  libraries are not copied again. </para>
    <para>Select the  <guimenuitem>Clean and Run</guimenuitem> menu item in the project context menu, if it is necessary to update the libraries in the <filename>web</filename> directory. The libraries will be removed, and at the next application launch these libraries will be copied from the platform&apos;s runtime directory.</para>
  </section>
  <section id="conn-management">
    <title>Database connections</title>
    <para>Define an application project&apos;s database connections and the  default connection of the application. The default connection  to be  used when a connection is not explicitly referenced in  application elements. </para>
    <para>Add a new database connection:</para>
    <itemizedlist>
      <listitem>
        <para>Open the  <guilabel>Services</guilabel> panel.</para>
      </listitem>
      <listitem>
        <para>Select the  <guimenuitem>New Connection</guimenuitem> menu item of the <guilabel>Databases</guilabel> node.</para>
      </listitem>
      <listitem>
        <para> In the <guilabel>New Connection</guilabel> dialog select the JDBC driver and provide the  JDBC URL, database credentials, scheme and  connection name. This name will be used as an string identifier to refer to the connection JNDI resource in the application.</para>
      </listitem>
    </itemizedlist>
    <para>A JDBC URL example for the H2 database server with a database located in the user&apos;s home directory <filename>db</filename>  subdirectory: <literal>jdbc:h2:tcp://localhost:9092/~/db</literal>.</para>
    <para>Specify the project&apos;s default database connection: go to the project&apos;s <guilabel>Properties</guilabel> and to the <guilabel>Running</guilabel> panel. Select the default connection from the <guilabel>Datasource</guilabel> combobox.</para>
    <para>When opening the project, the application designer tries to connect to the database, in case of failure  it switches to the limited functionality mode, and some editor tools  are disabled. </para>
    <note>
      <para>We recommend that a developer in the team working on the  project creates and uses his/her own copy of the database for debugging and testing purposes. Additionally, a common reference database is created, and all modifications, which have passed the debugging stage at the developers&apos; individual databases, are applied to this common one.  </para>
    </note>
    <para>Use the developer&apos;s local database on the H2 database server, supplied with the platform. </para>
    <para>To launch the built-in H2 database server:</para>
    <itemizedlist>
      <listitem>
        <para>Open the  <guilabel>Services</guilabel> panel.</para>
      </listitem>
      <listitem>
        <para>Select the   <menuchoice>
            <guimenu>Databases</guimenu>
            <guimenuitem>H2 node and enable the</guimenuitem>
          </menuchoice>  <guimenuitem>Start</guimenuitem> menu item.</para>
      </listitem>
    </itemizedlist>
    <para>After the  <acronym>database</acronym> server is launched and become available via the network or locally, connect to this server by selecting the  <guimenuitem>Connect to project database</guimenuitem> item in the context menu, or by clicking the <guibutton>Establish connection</guibutton> button on the  <guilabel>Application Database</guilabel> form in the project properties, or by selecting the  Connect to project database link on the stub-form of the data model editor.</para>
    <para>To disconnect, select the <guimenuitem>Disconnect from project database</guimenuitem> item in the project context menu.</para>
  </section>
  <section id="app-db">
    <title>Application in the database </title>
    <para>An application can be deployed in the special database table. After deployment, the application elements can be hosted in  the database.</para>
    <para>To deploy an application in the <acronym>database</acronym>: use   <guimenuitem>Deploy</guimenuitem> item in the project&apos;s root node context menu. When deploying, the application elements from the Application Elements folder are copied to the table   <literal>MTD_ENTITIES</literal>.  When copying, the tree structure of the application directories is preserved.</para>
    <para>Importing of an application from a  database to a files is a process which is  reverse to deployment. To import an application from the database: select the Import item in the project context menu. When importing, the application elements are copied from the <literal>MTD_ENTITIES</literal> table to the project&apos;s <guilabel>Application Elements</guilabel> folder. </para>
    <important>
      <para>When deploying and importing an application, the destination table or the <guilabel>Application Elements</guilabel> folder is cleared before the copy process starts.</para>
    </important>
  </section>
  <section id="db-migrations" arch="">
    <title>Database migrations tools</title>
    <para>To store and restore database(s) schema and its bootstrap data and use the database migration tools. </para>
    <important>
      <para>Backup you databases before applying  migrations.</para>
    </important>
    <para>Bootstrap data includes basic references, bootstrap data, etc., the  information required to start the application.</para>
    <para>Database structure and initial application data are represented in the form of migrations files. Each migration has a number expressed as a positive integer, which is used as the file name. In the course of development and further during the application life cycle, when changing the database structure or in case of  data modification, a migration is created. Later on, this migration can be applied to other  databases. In the application database, information about the current <acronym>database</acronym> version is maintained in the <literal>MTD_VERSION</literal> table. </para>
    <para>Migrations with the number greater than the  current database version are sequentially applied to the database during synchronization process. After the migration is applied successfully, the <acronym>database</acronym> number becomes equals to the number of this migration.</para>
    <para>Migrations types:</para>
    <itemizedlist>
      <listitem>
        <para><acronym>Database</acronym> structure snapshot is  a  <filename>.xdm</filename> file containing database metadata presentation in the XML format.</para>
      </listitem>
      <listitem>
        <para>SQL commands batch is  a  <filename>.batch</filename> file containing the SQL commands delimited by <code>#GO</code> separators tag. </para>
      </listitem>
    </itemizedlist>
    <note>
      <para>In the batch SQL file, it is recommended to use  <acronym>DML</acronym> (<literal>INSERT</literal>, <literal>UPDATE</literal> and <literal>DELETE</literal>) commands; although it is technically permissible to use  DDL commands there as well. However, it is not recommended to use  commands which modify the <acronym>database</acronym> structure in the batch SQL file, since it can reduce the application portability.</para>
    </note>
    <para>Refer to the Administration Guide for more information about using database migration tools.</para>
  </section>
  <section id="version-ctrl">
    <title>Version control</title>
    <para>During  application development and further during the application life cycle, it is recommended to use a version control system to manage the source project files.</para>
    <para><application>The application designer</application> has built-in support of the following version control systems: </para>
    <itemizedlist>
      <listitem>
        <para><application>Subversion</application></para>
      </listitem>
      <listitem>
        <para><application>Git</application></para>
      </listitem>
      <listitem>
        <para><application>Mercurial</application></para>
      </listitem>
    </itemizedlist>
    <para>To access options of these version control systems, use the <guimenuitem>Team</guimenuitem> item from the global menu and/or  <guisubmenu>Versioning</guisubmenu> sub-menu of the project context menu.</para>
    <note>
      <para>Refer to the documentation of the relevant version control system for details about this system usage.</para>
    </note>
  </section>
</chapter>
