<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "Development_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-Development_Guide-Diagram_Chapter">
  <title>Диаграмма структуры базы данных</title>
  <para><emphasis>Диаграмма структуры базы данных</emphasis>  является  представлением структуры <acronym>БД в части</acronym>, определенной разработчком. Например, диаграмма может описывать часть предметной области. В проекте, как правило, существует несколько диаграмм структуры БД.</para>
  <para>Диаграмма структуры БД является  визуальным  представлением структуры <acronym>БД</acronym>   и на прямую не влияет на функциональность приложения.</para>
  <para>Структура реляционной базы данных определяется составом
      таблиц и их связями. Связи между двумя таблицами реализуются
      через внешние ключи.</para>
  <note>
    <para>Подробное описание понятий &quot;таблица&quot;, &quot;внешний ключ&quot;, &quot;сущность&quot; и пр. см литературу по реляционным базам данных.</para>
  </note>
  <section id="sect-Administration_Guide-Diagram_Chapter-Test_Section_1">
    <title>Создание новой диаграммы структуры БД</title>
    <para>Для создания новой диаграммы структуры базы данных выполните следующие действия:
   
  </para>
    <itemizedlist>
      <listitem>
        <para>выберите пункт меню <guimenuitem>New</guimenuitem> контекстного меню родительского каталога или выделите родительский каталог и выберите пункт <guimenuitem>New Filе</guimenuitem> главного меню или нажмите кнопку <guibutton>New File</guibutton> на панели инструментов или воспользуйтесь &quot;горячей&quot; клавишей;</para>
      </listitem>
      <listitem>
        <para>выберите тип <guimenuitem>Database structure diagram</guimenuitem> из контекстного меню или на первом шаге мастера <menuchoice>
            <guimenu>Choose file type</guimenu>
            <guisubmenu>Platypus application elements</guisubmenu>
            <guimenuitem>Database structure diagram</guimenuitem>
          </menuchoice>  и нажмите <guibutton>Next</guibutton>;</para>
      </listitem>
      <listitem>
        <para>выберите соединение с <acronym>БД</acronym> и схему БД:</para>
        <itemizedlist>
          <listitem>
            <para>выберите базу данных по-умолчанию — нажмите кнопку <guibutton>Default</guibutton> или подключение к внешней базе данных — нажмите кнопку <guibutton>Specific</guibutton>;</para>
          </listitem>
          <listitem>
            <para>выберите схему в базе данных из выпадающего списка поля <guilabel>Schema</guilabel>; для выбора схемы по умолчанию нажмите кнопку <guibutton>Default</guibutton>;</para>
          </listitem>
          <listitem>
            <para>нажмите кнопку <guibutton>Next</guibutton>;</para>
          </listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>введите название новой диаграммы структуры <acronym>БД</acronym> в поле <guilabel>Name</guilabel> и  нажмите <guibutton>Finish</guibutton> для создания нового элемента приложения или <guibutton>Cancel</guibutton> для отмены.</para>
      </listitem>
    </itemizedlist>
    <para>После создания  диаграммы структуры <acronym>БД</acronym> сформируйте структуры таблиц. Для этого определите состав полей и
      задайте их описание. После определения структуры таблиц определите связи между таблицами.</para>
  </section>
  <section id="sect-Administration_Guide-Diagram_Chapter-Test_Section_2">
    <title>Редактирование диаграммы структуры БД</title>
    <para>Редактирование диаграммы структуры базы данных осуществляется при помощи специализированного редактора.</para>
    <para>Диаграмма БД представляет из себя визуальное представление таблиц базы, а также связей между ними. Одна диаграмма обычно включает в себя часть общей структуры базы, например, относящиеся к определенному  сегменту предметной области.  При помощи визуального редактора  осуществляется изменение структуры базы данных - добавление и удаление таблиц, связей между таблицами и индексов. Одна и та же таблица может быть представлена на нескольких диаграммах.</para>
    <para>Для навигации по диаграмме удобно использовать инспектор диаграммы. В инспекторе диаграммы таблицы и их поля представлены в виде дерева. При выделении таблицы или поля в инспекторе, происходит такое же выделение на диаграмме. Кроме того, имеется возможность взаимного позиционирования инспектора и диаграммы. </para>
    <para>Для того, чтобы взаимно спозиционировать узел в инспекторе и объект на диаграмме выберите пункт меню <menuchoice>
        <guimenu>Show in diagram</guimenu>
      </menuchoice> в контектсном меню узла таблицы.</para>
    <para>Для добавления на диаграмму существующей таблицы выполните следующие действия:
   
  </para>
    <itemizedlist>
      <listitem>
        <para>выберите пункт меню <menuchoice>
            <guimenu>Add table</guimenu>
          </menuchoice>  -      на панели инструментов редактора или воспользуйтесь &quot;горячей&quot; клавишей <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>Insert</keycap>
          </keycombo>;</para>
      </listitem>
      <listitem>
        <para>выберите таблицу из списка в диалоге выбора таблицы, при необходимости воспользуйтесь поиском, нажав на кнопку <guibutton>Find</guibutton>;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>OK</guibutton> для добавления таблицы или <guibutton>Cancel</guibutton> для отмены;</para>
      </listitem>
      <listitem>
        <para>при необходимости передвиньте таблицу на диаграмме в нужное  место;</para>
      </listitem>
      <listitem>
        <para>сохраните элемент приложения нажав кнопку <guibutton>Save All</guibutton> на  панели инструментов <application>Platypus Application Designer</application> или нажав сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>S</keycap>
          </keycombo>;</para>
      </listitem>
    </itemizedlist>
    <para>Для создания новой таблицы и добавления её  на диаграмму  выполните следующие действия:
   
  </para>
    <itemizedlist>
      <listitem>
        <para>выберите пункт меню  <menuchoice>
            <guimenu>Add table</guimenu>
            <guimenuitem>Create new table</guimenuitem>
          </menuchoice>      на панели инструментов редактора;</para>
      </listitem>
      <listitem>
        <para>введите имя новой таблицы в диалоге;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>OK</guibutton> для добавления таблицы или <guibutton>Cancel</guibutton> для отмены;</para>
      </listitem>
      <listitem>
        <para>при необходимости передвиньте таблицу на диаграмме в нужное  место;</para>
      </listitem>
      <listitem>
        <para>сохраните элемент приложения нажав кнопку <guibutton>Save All</guibutton> на  панели инструментов Platypus Application Designer или нажав сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>S</keycap>
          </keycombo>.</para>
      </listitem>
    </itemizedlist>
    <note>
      <para>Для новой таблицы будет автоматически  создано  числовое поле идентификатора и ограничение первичного ключа.</para>
    </note>
    <para>Для удаления таблицы из  диаграммы выполните следующие действия:</para>
    <itemizedlist>
      <listitem>
        <para>выберите таблицу на диаграмме;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>Delete</guibutton>        на панели инструментов редактора;</para>
      </listitem>
      <listitem>
        <para>на диалоге подтверждения удаления нажимите кнопку <guibutton>Delete from diagram</guibutton> для того, чтобы удалить таблицу из диаграммы (только из диаграммы, а не из <acronym>БД</acronym>) кнопку <guibutton>Drop table</guibutton>   для того, чтобы удалить таблицу из базы данных (при этом таблица будет уничтожена физически) или кноку <guibutton>Cancel</guibutton> для отмены удаления;</para>
      </listitem>
      <listitem>
        <para>сохраните элемент приложения нажав кнопку <guibutton>Save All</guibutton> на  панели инструментов <application>Platypus Application Designer</application> или нажав сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>S</keycap>
          </keycombo>.</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы добавить поля таблицы: </para>
    <itemizedlist>
      <listitem>
        <para>выберите таблицу на диаграмме;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>Create new field/parameter</guibutton>    на панели инструментов вкладки редактора полей таблицы — будет создано поле с типом по умолчанию и автоматически сгенерированным именем;</para>
      </listitem>
      <listitem>
        <para>измените свойства поля таблицы, для этого выберети узел поля среди дочерних узлов таблицы в инспекторе модели данных и измените свойства в окне редактирования  свойств <guilabel>Properties</guilabel>:</para>
      </listitem>
    </itemizedlist>
    <para>Свойства поля таблицы:</para>
    <itemizedlist>
      <listitem>
        <para><guilabel>Name</guilabel> — наименование поля в таблице;</para>
      </listitem>
      <listitem>
        <para><guilabel>Description</guilabel> — описание поля;</para>
      </listitem>
      <listitem>
        <para><guilabel>Type</guilabel> — тип данных;</para>
      </listitem>
      <listitem>
        <para><guilabel>Type Name</guilabel> — имя типа структуры данных, поле доступно для ввода если выбран тип данных <parameter>STRUCT</parameter>;</para>
      </listitem>
      <listitem>
        <para><guilabel>Size</guilabel> — длина поля;</para>
      </listitem>
      <listitem>
        <para><guilabel>Precision</guilabel> — точность;</para>
      </listitem>
      <listitem>
        <para><guilabel>Required</guilabel> — обязательное поле (в поле недопустимы значения <literal>NULL)</literal>;</para>
      </listitem>
      <listitem>
        <para><guilabel>Default value</guilabel> — значение по умолчанию;</para>
      </listitem>
    </itemizedlist>
    <informaltable>
      <blockinfo>
        <title>Типы данный полей в Platypus</title>
      </blockinfo>
      <textobject>
        <para>Параметры режима развертывания</para>
      </textobject>
      <tgroup cols="2">
        <thead>
          <row>
            <entry align="center">Наименование типа</entry>
            <entry align="center">Описание</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              <parameter>NUMERIC</parameter>
            </entry>
            <entry>Число</entry>
          </row>
          <row>
            <entry>
              <parameter>VARCHAR</parameter>
            </entry>
            <entry>Строка ограниченной длины</entry>
          </row>
          <row>
            <entry>
              <parameter>TIMESTAMP</parameter>
            </entry>
            <entry>Дата и время</entry>
          </row>
          <row>
            <entry>
              <parameter>DATE</parameter>
            </entry>
            <entry>Дата</entry>
          </row>
          <row>
            <entry>
              <parameter>STRUCT</parameter>
            </entry>
            <entry>Структура</entry>
          </row>
          <row>
            <entry>
              <parameter>BLOB</parameter>
            </entry>
            <entry>Двоичные данные неограниченной длины</entry>
          </row>
          <row>
            <entry>
              <parameter>CLOB</parameter>
            </entry>
            <entry>Строка неограниченной длины</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>Для редактирования поля выполните следующие действия:</para>
    <itemizedlist>
      <listitem>
        <para>выберите узел поля среди дочерних узлов таблицы в инспекторе модели данных;</para>
      </listitem>
      <listitem>
        <para>отредактируйте параметры поля в окне редактора свойств <guilabel>Properties</guilabel>; </para>
      </listitem>
    </itemizedlist>
    <important>
      <para>Не используйте для полей таблиц следующие имена: <literal>md</literal>, <literal>params</literal>.</para>
      <para>Эти имена являются зарезервированными и используются моделью данных  Platypus.</para>
    </important>
    <note>
      <para>Если панель свойств <guilabel>Properties</guilabel> не отображается, включите эту панель — для этого выберите пункт <menuchoice>
          <guimenu> Window</guimenu>
          <guimenuitem>Properties</guimenuitem>
        </menuchoice> главного меню<application> Platypus Application Designer</application>. </para>
    </note>
    <para>Для удаления поля выполните следующие действия:</para>
    <itemizedlist>
      <listitem>
        <para>выберите поле в таблице на диаграмме;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>Delete</guibutton>        на панели инструментов редактора полей или нажмите сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Delete</keycap>
          </keycombo>;</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы  редактировать индексы таблицы, используйте инспектор: раскройте узел соответсвующей таблицы, и используйте узел <guilabel>Indexes</guilabel>.</para>
    <para>Для того, чтобы добавить новый индекс:</para>
    <itemizedlist>
      <listitem>
        <para>выберите пункт меню <guimenuitem>Add index</guimenuitem> контекстного меню узла <guilabel>Indexes</guilabel> соответсвующей таблицы;</para>
      </listitem>
      <listitem>
        <para>в диалоге выбора колонок таблицы выберите необходимые поля и нажмите кнопку для добавления <guibutton>OK</guibutton> или <guibutton>Cancel</guibutton> для отмены;</para>
      </listitem>
      <listitem>
        <para>при необходимости удалите поле из индекса  используя пункт <guimenuitem>Delete</guimenuitem> контекстного меню колонки индекса;</para>
      </listitem>
      <listitem>
        <para>при необходимости измените порядок  полей в индексе используя пункты <guimenuitem>Move up</guimenuitem> и <guimenuitem>Move down</guimenuitem>  контекстного меню колонки индекса;</para>
      </listitem>
      <listitem>
        <para>при необходимости измените состояние флажка <guilabel>Ascending</guilabel> на панели свойств для колонки индекса, задав порядок сортировки по возрастанию или убыванию;</para>
      </listitem>
      <listitem>
        <para>задайте имя индекса в поле <guilabel>Index name</guilabel> на панели свойств узла индекса;</para>
      </listitem>
      <listitem>
        <para>при необходимости установите флажок <guilabel>Unique</guilabel> на  панели свойств узла индекса, чтобы сделать индекс уникальным или не уникальным;</para>
      </listitem>
      <listitem>
        <para>при необходимости установите флажок <guilabel>Clustered</guilabel> на  панели свойств узла индекса, чтобы сделать индекс кластерным;</para>
      </listitem>
      <listitem>
        <para>при необходимости установите флажок <guilabel>Hashed</guilabel> на  панели свойств узла индекса, чтобы включить или выключить хеширование для этого индекса;</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы изменить индекс:</para>
    <itemizedlist>
      <listitem>
        <para>выберите индекс в списке индексов таблицы;</para>
      </listitem>
      <listitem>
        <para>отредактируйте индекс аналогично действиям по добавлению нового индекса;</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы удалить индекс:</para>
    <itemizedlist>
      <listitem>
        <para>выберите индекс среди дочерних узлов соответствующей таблицы в инспекторе;</para>
      </listitem>
      <listitem>
        <para>выберите пункт меню <guimenuitem>Delete контекстного меню узла индекса</guimenuitem>;</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы добавить внешний ключ таблицы:</para>
    <itemizedlist>
      <listitem>
        <para>перетащите мышкой поле одной таблицы на поле-первичный ключ другой таблицы; </para>
        <para>после этого в базе данных будет создан внешний ключ; визуально связь будет представлена линией со стрелкой  между полями таблиц;</para>
        <important>
          <para>Типы полей, связанные внешним ключом, должны быть одинаковыми. Для создания древовидной структуры (унарной связи) перетащите мышкой поле таблицы на поле - первичный ключ той же самой таблицы; </para>
        </important>
      </listitem>
      <listitem>
        <para>сохраните элемент приложения нажав кнопку <guibutton>Save All</guibutton> на  панели инструментов <application>Platypus Application Designer</application> или нажав сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>S</keycap>
          </keycombo>.</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы удалить внешний ключ таблицы:</para>
    <itemizedlist>
      <listitem>
        <para>выделите связь внешнего ключа мышью;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton> Delete</guibutton> или используйте комбинацию клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Delete</keycap>
          </keycombo>:</para>
      </listitem>
      <listitem>
        <para>сохраните элемент приложения нажав кнопку <guibutton>Save All</guibutton> на  панели инструментов <application>Platypus Application Designer</application> или нажав сочетание клавиш <keycombo>
            <keycap>Ctrl</keycap>
            <keycap>Shift</keycap>
            <keycap>S</keycap>
          </keycombo>.</para>
      </listitem>
    </itemizedlist>
    <note>
      <para>При работе в команде разработчиков после изменения структуры <acronym>БД</acronym> рекомендуется создать миграцию - мгновенный снимок  метаданных и сделать его доступным другим участникам процесса разработки, для того, чтобы применить сделанные изменения на других экземплярах баз, участвующих в разработке.</para>
    </note>
    <para>Для того, чтобы выполнить запрос данных из таблицы:</para>
    <itemizedlist>
      <listitem>
        <para>перейдите на вкладку <guilabel>Database schema</guilabel>;</para>
      </listitem>
      <listitem>
        <para>выберите таблицу на диаграмме;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton> Query Table Data</guibutton> — будет выполнен запрос данных из таблицы, а результаты будут показаны в зоне вывода редактора.</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы изменить размер визуального представления  диаграммы структуры БД:</para>
    <itemizedlist>
      <listitem>
        <para>перейдите на вкладку <guilabel>Database schema</guilabel>;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton> Zoom In</guibutton> для того, чтобы увеличить, и кнопку <guibutton>Zoom out</guibutton> для того, чтобы уменьшить представление структуры БД в редакторе.</para>
      </listitem>
    </itemizedlist>
    <para>Для того, чтобы воспользоваться поиском по диаграмме:</para>
    <itemizedlist>
      <listitem>
        <para>перейдите на вкладку <guilabel>Database schema</guilabel>;</para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton> Find</guibutton> для того, чтобы открыть диалог поиска по диаграмме;</para>
      </listitem>
      <listitem>
        <para>введите строку поиска; </para>
      </listitem>
      <listitem>
        <para>выберите  поля по которым будет осуществляются поиск: <guilabel>Datasets</guilabel>, <guilabel>Fields</guilabel>, <guilabel>Params</guilabel>, а также установите флажки опций: <guilabel>Whole words</guilabel> — для поиска целых слов, <guilabel>Match case</guilabel> — для поиска с учетом регистра символов; </para>
      </listitem>
      <listitem>
        <para>нажмите кнопки <guibutton>Next</guibutton> и <guibutton>Previous</guibutton> для перехода к следующей найденной сущности; </para>
      </listitem>
      <listitem>
        <para>нажмите кнопку <guibutton>Close</guibutton> чтобы закрыть диалог поиска. </para>
      </listitem>
    </itemizedlist>
  </section>
</chapter>
