[[конфигурирование-и-запуск-клиента-platypus]]
Конфигурирование и запуск клиента Platypus
------------------------------------------

Клиент Platypus является Java SE программой и предназначен для
организации интерфейса пользователя и/или исполнения логики приложения
на компьютере конечного пользователя. Клиент Platypus загружает
требуемые элементы приложения с сервера приложений, из базы данных или
читает непосредственно с диска, из папки, указанной при
конфигурировании.

Клиент Platypus обеспечивает автоматическую проверку обновлений и
предлагает из установку.

[[режимы-работы-клиента-platypus]]
Режимы работы клиента Platypus
------------------------------

Клиент Platypus может работать в следующих режимах:

* 2-х звенный режим — Java SE клиент подключается непосредственно к
серверу БД. Данная схема рекомендуется для относительно несложных
приложений, не требующих исполнения бизнес-логики на сервере.
+
image:images/2-tiers.png[2-х звенная схема в Platypus]
* 3-х звенный режим с сервером Platypus — клиент подключается к серверу
Platypus Application Server. Для передачи данных используется двоичный
протокол Platypus Protocol. Сервер приложений в свою очередь
взаимодействует с сервером БД. Этот режим рекомендуется для приложений
средней сложности, предполагающих исполнение бизнес-логики на сервере
приложений.
+
image:images/3-tiers.png[3-х звенный режим с сервером Platypus]
* 3-х звенный режим с J2EE сервером - клиент подключается к
сервлет-контейнеру или J2EE серверу, на котором развернуты серверные
компоненты Platypus. Клиентом в данном случае может являться как Java SE
клиент, так и HTML5 браузер (Chrome, Opera, Firefox и т.д.). Для
передачи данных используется протокол HTTP/HTTPS. В этом случае, для
подключения к базам данных используется ресурс источника данных,
предоставляемого контейнером. Для данного варианта подключения требуется
развертывание серверных компонентов Platypus в сервлет-контейнер или
J2EE сервер.
+
image:images/3-tiers-j2ee.png[З-х звенный режим с J2EE сервером]

[[запуск-клиента]]
Запуск клиента
--------------

Для запуска Java SE клиента необходимо использовать ярлык Platypus
Client на рабочем столе, меню Пуск или запустить стартовый скрипт.

Скрипты запуска и загрузчик клиента Platypus находятся в папке `/run` :

* `platypus.exe` — для запуска в ОС Windows без создания окна командной
строки с предварительным запуском обновления клиента; данная команда
обеспечивает корректную работу с UAC (User Account Control) в ОС
Windows;
* `platypus.js` — скрипт для запуска в ОС Windows без проверки
обновлений;
* `platypus.sh` — для запуска клиента в ОС Linux;
* `startupdate.sh` — для запуска клиента в ОС Linux с предварительным
запуском обновления клиента.

При успешном запуске, клиент выводит диалоговое окно для ввода имени
пользователя и пароля и выбора предварительно настроенного подключения к
серверу.

Вы можете создать и использовать несколько предварительно настроенных
подключений к БД или серверу Platypus. В ваш дистрибутив может быть
включено предварительно настроенное подключение по умолчанию.

В случае работы по 2-х звенной схеме введите имя пользователя и пароль
соединения с базой данных, а также имя пользователя и пароль в
приложениях Platypus.

В случае работы по одной из 3-х звенной схеме введите только имя
пользователя и пароль приложений Platypus.

Используйте флажки Запомнить пароль БД и Запомнить пароль, если
необходимо запомнить пароль БД и/или пароль приложений Platypus.

Используйте кнопку >>> и <<< для того чтобы отобразить и скрыть панель
предварительно настроенных подключений.

Выберите предварительно настроенное подключение из списка для того чтобы
подключиться к серверу и запустить клиента.

Создание и редактирование предварительно настроенных подключений.

Для того, чтобы отобразить диалог создания нового подключения нажмите
кнопку Новое на панели предварительно настроенных подключений.

Для того, чтобы изменить предварительно настроенное подключение выберите
его из списка и нажмите кнопку Изменить на панели предварительно
настроенных подключений.

Введите или измените следующие поля диалога "Настройки соединения":

* Наименование — наименование подключения, например, `myserver`; в
данном поле может быть введено любое название;
* URL подключения — строка соединения с сервером, для работы по 2х
звенной схеме должна быть в формате JDBC URL, например:
`jdbc:oracle:thin:@dbhost:1521:adb`,
+
для работы по 3-х звенной схеме по протоколу Platypus Protocol
используйте URL формата `platypus://`, например,
`platypus://serverhost:8500`, порт 8500 является портом по умолчанию для
протокола Platypus, и его можно в данном случае не указывать;
+
для работы по 3-х звенной схеме по протоколу HTTP используйте URL
формата `http://`, например, `http://localhost/myapp/application`.
* Схема — схема БД по умолчанию, например, `myschema`; в случае 3-х
звенного подключения не используется;
* Пользователь БД - имя пользователя БД по умолчанию, например, `user1`;
в случае 3-х звенного подключения не используется.
* для сохранения новых настроек подключения нажмите кнопку ОК диалога;
для отмены кнопку Отмена.

Для того чтобы удалить предварительно настроенное соединение выберите
соединение из списка и нажмите кнопку Удалить на панели предварительно
настроенных соединений. Подключение будет удалено после того как
пользователь нажмет кнопку ОК в диалоге подтверждения удаления.

Для запуска клиента с выбранным подключением нажмите кнопку ОК. Для
того, чтобы закрыть диалог выбора подключений нажмите кнопку Отмена.

После запуска клиента будет запущен элемент приложения по умолчанию
(форма, отчет или модуль) для данного пользователя или элемент
приложения явно указанный в параметре `-appElement` командной строки
запуска.

[[настройка-скриптов-и-параметры-командной-строки-запуска-клиента]]
Настройка скриптов и параметры командной строки запуска клиента
---------------------------------------------------------------

Данный раздел содержит подробную справочную информацию по параметрам
командной строки запуска клиента Platypus.

Для настройки запуска клиента Platypus отредактируйте содержимое файлов
скриптов запуска. Могут быть настроены следующие параметры:

* элемент приложения по умолчанию — идентификатор формы, отчета или
модуля который будет открыт при запуске клиента, например
`appStartForm`, в случае, если этот параметр не будет указан, клиент
будет использовать элемент по умолчанию для текущего пользователя;
* тема оформления (LaF — Look and Feel) внешнего вида клиента. Клиент
Platypus может использовать LaF графической оболочки Swing платформы
Java SE. Допустимо использовать как стандартные LaF для данной
операционной системы так и библиотечные от сторонних производителей;
* уровень настройки логов и файл записи логов.

Команда для запуска клиента Platypus имеет следующий вид:

------------------------------------------------------------------------------
java -cp Application.jar;com.eas.client.application.PlatypusClientApplication 
------------------------------------------------------------------------------

где EXT_CLASSPATH — пути, которые должны быть добавлены в путь поиска
загрузчика классов Java, OPTIONS — дополнительные параметры запуска.

В начале настройки рекомендуется запускать скрипты через командную
строку, чтобы увидеть возможные сообщения об ошибках. В случае удачного
запуска клиента появится диалог авторизации.

Так же клиента можно запустить с использованием параметра `-jar`:

--------------------------
java -jar Application.jar 
--------------------------

Такой вариант запуска удобен при работе с командной строкой, однако
такой подход не позволяет добавлять внешние библиотеки в путь по
которому загрузчик Java ищет классы, например, для того чтобы подключать
произвольные темы оформления Look and Feel.

.Параметры запуска клиента из командной строки
[cols="<,<",]
|=======================================================================
|Параметр |Описание

|`-appElement APP_ELEMENT` |Идентификатор элемента приложения для
запуска.

|`-ap APP_PATH` |Путь к папке, содержащей элементы приложения Platypus.
Если этот параметр задан, то клиент Platypus будет искать элементы
приложения Platypus в этой папке, в противном случае клиент Platypus
будет искать элементы приложения в базе данных в соотвтествующих
таблицах.

|`-url JDBC_URL` |URL соеденения с БД в формате JDBC.

|`-dbuser DB_USER` |Имя пользователя для авторизации в БД.

|`-dbpassword DB_PASSWORD` |Пароль пользователя для авторизации в БД.

|`-dbschema DB_SCHEMA` |Схема БД.

|`-user USER_NAME` |Имя пользвателя приложения Platypus.

|`-password PASSWORD` |Пароль пользвателя приложения Platypus.

|`-loglevel LOG_LEVEL` |Уровень ведения журнала. Данный параметр
указывает минимальный уровень который будет выводится в журнал. Описание
уровней журнала смотрите в Приложении A.

|`-log LOG_FILE_PATH` |Имя и путь к файлу журнала.
|=======================================================================

Если параметры настройки соеденения с БД или имя пользвателя и пароль
Platypus не заданы будет отображен диалог "Настройки соединения" для
ввода этих параметров.

Пример команды запуска клиента Platypus:

---------------------------------------------------------------------------------------------------------------------------
java -cp Application.jar;CoolLaf.jar -laf CoolLaf com.eas.client.application.PlatypusClientApplication -appElement mainForm
---------------------------------------------------------------------------------------------------------------------------

Пример запуска клиента с использованием параметра `-jar`:

----------------------------------------------
java -jar Application.jar -appElement mainForm
----------------------------------------------
